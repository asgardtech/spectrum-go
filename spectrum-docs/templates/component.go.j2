package sp

import "github.com/maxence-charriere/go-app/v10/pkg/app"

{% if component.attributes %}
{# Generate enum types #}
{% for attr in component.attributes %}
{% if attr.type == "enum" and attr.values_list %}
// {{ attr.go_type }} represents the {{ attr.description|default(attr.name) }}
type {{ attr.go_type }} string

// {{ attr.go_type }} values
const (
{% for value in attr.values_list %}
{% if value != "" %}
    {{ attr.go_type }}{{ value|replace("-", " ")|title|replace(" ", "") }} {{ attr.go_type }} = "{{ value }}"
{% endif %}
{% endfor %}
)
{% endif %}
{% endfor %}
{% endif %}

// {{ component.struct_name }} represents an {{ component.tagName }} component
type {{ component.struct_name }} struct {
    app.Compo
    *styler[*{{ component.struct_name }}]

    // Properties
{% for attr in component.attributes %}
    {% if attr.description %}
    // {{ attr.description }}
    {% endif %}
    {{ attr.prop_name }} {{ attr.go_type }}
{% endfor %}

{% if component.has_text_prop %}
    // Text content for the default slot
    PropText string
{% endif %}

{% if component.slots %}
    // Content slots
{% for slot in component.slots %}
{% if slot.name != "default" %}
    {{ slot.prop_name }} app.UI
{% endif %}
{% endfor %}
{% endif %}

{% if component.children %}
    // Child components
    PropChildren []app.UI
{% endif %}

{% if component.events %}
    // Event handlers
{% for event in component.events %}
    {{ event.prop_name }} app.EventHandler
{% endfor %}
{% endif %}
}

// {{ component.name }} creates a new {{ component.tagName }} component
func {{ component.name }}() *{{ component.struct_name }} {
    element := &{{ component.struct_name }}{
{% for attr in component.attributes %}
{% if attr.default is defined and attr.default is not none %}
        {{ attr.prop_name }}: {% if attr.type == "string" %}"{{ attr.default }}"{% elif attr.type == "boolean" %}{{ "true" if attr.default else "false" }}{% elif attr.type == "enum" %}{% if attr.default %}{{ attr.go_type }}{{ attr.default|replace("-", " ")|title|replace(" ", "") }}{% else %}""{% endif %}{% elif attr.type == "object" %}map[string]interface{}{}{% else %}{{ attr.default }}{% endif %},
{% elif attr.type == "array" %}
        {{ attr.prop_name }}: {{ attr.init_value }},
{% elif attr.type == "object" %}
        {{ attr.prop_name }}: map[string]interface{}{},
{% endif %}
{% endfor %}
    }

    element.styler = newStyler(element)

    return element
}

{% for attr in component.attributes %}
{% if attr.description %}
// {{ attr.description }}
{% endif %}
func (c *{{ component.struct_name }}) {{ attr.go_name }}({% if attr.parameter_name == "type" %}typeValue{% elif attr.parameter_name == "for" %}forValue{% elif attr.parameter_name == "range" %}rangeValue{% elif attr.parameter_name == "select" %}selectValue{% elif attr.parameter_name == "map" %}mapValue{% elif attr.parameter_name == "interface" %}interfaceValue{% elif attr.parameter_name == "switch" %}switchValue{% elif attr.parameter_name == "case" %}caseValue{% elif attr.parameter_name == "default" %}defaultValue{% elif attr.parameter_name == "func" %}funcValue{% elif attr.parameter_name == "defer" %}deferValue{% elif attr.parameter_name == "package" %}packageValue{% elif attr.parameter_name == "import" %}importValue{% elif attr.parameter_name == "go" %}goValue{% else %}{{ attr.parameter_name }}{% endif %} {{ attr.go_type }}) *{{ component.struct_name }} {
    c.{{ attr.prop_name }} = {% if attr.parameter_name == "type" %}typeValue{% elif attr.parameter_name == "for" %}forValue{% elif attr.parameter_name == "range" %}rangeValue{% elif attr.parameter_name == "select" %}selectValue{% elif attr.parameter_name == "map" %}mapValue{% elif attr.parameter_name == "interface" %}interfaceValue{% elif attr.parameter_name == "switch" %}switchValue{% elif attr.parameter_name == "case" %}caseValue{% elif attr.parameter_name == "default" %}defaultValue{% elif attr.parameter_name == "func" %}funcValue{% elif attr.parameter_name == "defer" %}deferValue{% elif attr.parameter_name == "package" %}packageValue{% elif attr.parameter_name == "import" %}importValue{% elif attr.parameter_name == "go" %}goValue{% else %}{{ attr.parameter_name }}{% endif %}

    return c
}

{% if attr.type == "boolean" %}
func (c *{{ component.struct_name }}) Set{{ attr.go_name }}() *{{ component.struct_name }} {
    return c.{{ attr.go_name }}(true)
}

{% endif %}
{% if attr.type == "enum" and attr.values_list %}
{% for value in attr.values_list %}
{% if value != "" %}
func (c *{{ component.struct_name }}) {{ attr.go_name }}{{ value|replace("-", " ")|title|replace(" ", "") }}() *{{ component.struct_name }} {
    return c.{{ attr.go_name }}({{ attr.go_type }}{{ value|replace("-", " ")|title|replace(" ", "") }})
}
{% endif %}
{% endfor %}
{% endif %}
{% endfor %}

{% if component.has_text_prop %}
// Text sets the text content for the default slot
func (c *{{ component.struct_name }}) Text(text string) *{{ component.struct_name }} {
    c.PropText = text
    return c
}

{% endif %}

{% for slot in component.slots %}
{% if slot.name != "default" %}
{% if slot.description %}
// {{ slot.description }}
{% endif %}
func (c *{{ component.struct_name }}) {{ slot.go_name }}(content app.UI) *{{ component.struct_name }} {
    c.{{ slot.prop_name }} = content

    return c
}

{% endif %}
{% endfor %}

{% if component.children %}
// Children sets the child components
func (c *{{ component.struct_name }}) Children(children ...app.UI) *{{ component.struct_name }} {
    c.PropChildren = children

    return c
}

// AddChild adds a child component
func (c *{{ component.struct_name }}) AddChild(child app.UI) *{{ component.struct_name }} {
    c.PropChildren = append(c.PropChildren, child)

    return c
}

{% endif %}

{% for event in component.events %}
{% if event.description %}
// {{ event.description }}
{% endif %}
func (c *{{ component.struct_name }}) On{{ event.go_name }}(handler app.EventHandler) *{{ component.struct_name }} {
    c.{{ event.prop_name }} = handler

    return c
}

{% endfor %}

// Render renders the {{ component.tagName }} component
func (c *{{ component.struct_name }}) Render() app.UI {
    element := app.Elem("{{ component.tagName }}")

    // Set attributes
{% for attr in component.attributes %}
{% if attr.type == "boolean" %}
    if c.{{ attr.prop_name }} {
        element = element.Attr("{{ attr.name }}", true)
    }
{% elif attr.type == "string" or attr.go_type == "string" %}
    if c.{{ attr.prop_name }} != "" {
        element = element.Attr("{{ attr.name }}", c.{{ attr.prop_name }})
    }
{% elif attr.type == "enum" %}
    if c.{{ attr.prop_name }} != "" {
        element = element.Attr("{{ attr.name }}", string(c.{{ attr.prop_name }}))
    }
{% elif attr.type == "array" %}
    if len(c.{{ attr.prop_name }}) > 0 {
        element = element.Attr("{{ attr.name }}", c.{{ attr.prop_name }})
    }
{% elif attr.type == "number" or attr.type == "integer" %}
    if c.{{ attr.prop_name }} != 0 {
        element = element.Attr("{{ attr.name }}", c.{{ attr.prop_name }})
    }
{% elif attr.type == "object" %}
    if c.{{ attr.prop_name }} != nil {
        element = element.Attr("{{ attr.name }}", c.{{ attr.prop_name }})
    }
{% else %}
    if c.{{ attr.prop_name }} != nil {
        element = element.Attr("{{ attr.name }}", c.{{ attr.prop_name }})
    }
{% endif %}
{% endfor %}

{% if component.events %}
    // Add event handlers
{% for event in component.events %}
    if c.{{ event.prop_name }} != nil {
        element = element.On("{{ event.name }}", c.{{ event.prop_name }})
    }
{% endfor %}
{% endif %}

{% if component.slots or component.children or component.has_text_prop %}
    // Add slots and children
    slotElements := []app.UI{}

{% if component.has_text_prop %}
    // Add text content for default slot if specified
    if c.PropText != "" {
        slotElements = append(slotElements, app.Text(c.PropText))
    }
{% endif %}

{% for slot in component.slots %}
{% if slot.name != "default" %}
    // Add {{ slot.name }} slot
    if c.{{ slot.prop_name }} != nil {
        slotElem := c.{{ slot.prop_name }}
        if slotWithAttr, ok := slotElem.(interface{ Slot(string) app.UI }); ok {
            slotElem = slotWithAttr.Slot("{{ slot.name }}")
        } else {
            slotElem = app.Elem("div").
                Attr("slot", "{{ slot.name }}").
                Body(slotElem)
        }
        slotElements = append(slotElements, slotElem)
    }
{% endif %}
{% endfor %}

{% if component.children %}
    // Add children
    if len(c.PropChildren) > 0 {
        for _, child := range c.PropChildren {
            slotElements = append(slotElements, child)
        }
    }
{% endif %}

    // Add all elements to the component
    if len(slotElements) > 0 {
        element = element.Body(slotElements...)
    }
{% endif %}

    element = element.Styles(c.styler.styles)

    return element
} 